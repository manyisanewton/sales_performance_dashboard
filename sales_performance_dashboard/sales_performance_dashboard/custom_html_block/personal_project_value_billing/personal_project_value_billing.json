{
 "doctype": "Custom HTML Block",
 "name": "Personal Project Value & Billing",
 "module": "Sales Performance Dashboard",
 "private": 0,
 "html": "<div class='ppvb-card'><div class='ppvb-title'>Project Value & Billing</div><div class='ppvb-sub'>Contract value, billed to date, unbilled value, and billing progress per project.</div><div class='ppvb-summary'><div class='ppvb-metric'><span>Contract Value</span><b class='ppvb-contract'>Sh 0.00</b></div><div class='ppvb-metric'><span>Billed to Date</span><b class='ppvb-billed'>Sh 0.00</b></div><div class='ppvb-metric'><span>Unbilled Value</span><b class='ppvb-unbilled'>Sh 0.00</b></div><div class='ppvb-metric'><span>% Billed</span><b class='ppvb-percent'>0.00%</b></div></div><div class='ppvb-list'></div></div>",
 "script": "const method = 'sales_performance_dashboard.api.personal_dashboard_api.get_personal_project_value_billing';\nconst listWrap = root_element.querySelector('.ppvb-list');\nconst contractEl = root_element.querySelector('.ppvb-contract');\nconst billedEl = root_element.querySelector('.ppvb-billed');\nconst unbilledEl = root_element.querySelector('.ppvb-unbilled');\nconst percentEl = root_element.querySelector('.ppvb-percent');\n\nfunction money(v){ return format_currency(flt(v || 0)); }\n\nfunction args(){\n  return {\n    department: localStorage.getItem('spd_personal_dashboard_department') || '',\n    employee: localStorage.getItem('spd_personal_dashboard_employee') || '',\n    limit: 20\n  };\n}\n\nfunction rowHtml(r){\n  const billedPct = Math.max(0, Math.min(100, flt(r.percent_billed || 0)));\n  const unbilledPct = 100 - billedPct;\n  return `<div class='ppvb-row'>\n    <div class='ppvb-row-head'>\n      <span class='ppvb-project' title='${frappe.utils.escape_html(r.project)}'>${frappe.utils.escape_html(r.project_label || r.project)}</span>\n      <span class='ppvb-values'>${money(r.billed_to_date)} / ${money(r.contract_value)}</span>\n    </div>\n    <div class='ppvb-bars'>\n      <div class='ppvb-bar billed' style='width:${billedPct}%'></div>\n      <div class='ppvb-bar unbilled' style='width:${unbilledPct}%'></div>\n    </div>\n    <div class='ppvb-row-foot'>\n      <span>% Billed: <b>${format_number(billedPct, null, 2)}%</b></span>\n      <span>Unbilled: <b>${money(r.unbilled_value)}</b></span>\n    </div>\n  </div>`;\n}\n\nfunction render(payload){\n  const summary = payload.summary || {};\n  const rows = payload.projects || [];\n\n  contractEl.textContent = money(summary.contract_value);\n  billedEl.textContent = money(summary.billed_to_date);\n  unbilledEl.textContent = money(summary.unbilled_value);\n  percentEl.textContent = `${format_number(flt(summary.percent_billed || 0), null, 2)}%`;\n\n  if (!rows.length){\n    listWrap.innerHTML = `<div class='ppvb-empty'>No projects found for this user scope.</div>`;\n    return;\n  }\n\n  listWrap.innerHTML = rows.map(rowHtml).join('');\n}\n\nfunction load(){\n  frappe.call({ method, args: args() }).then((r)=> render(r.message || {}));\n}\n\nwindow.addEventListener('spd-personal-changed', load);\nload();",
 "style": ".ppvb-card{background:var(--card-bg, var(--fg-color));border:1px solid var(--border-color);border-radius:14px;padding:14px;box-shadow:0 3px 14px rgba(15,23,42,.05)}.ppvb-title{font-size:20px;font-weight:700}.ppvb-sub{color:var(--text-muted);font-size:12px;margin:3px 0 12px}.ppvb-summary{display:grid;grid-template-columns:repeat(4,minmax(150px,1fr));gap:10px;margin-bottom:12px}.ppvb-metric{border:1px solid var(--border-color);border-radius:10px;padding:10px;background:var(--card-bg, var(--fg-color))}.ppvb-metric span{display:block;font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.02em}.ppvb-metric b{display:block;margin-top:4px;font-size:22px;font-weight:800;color:var(--text-color)}.ppvb-billed{color:#15803d!important}.ppvb-unbilled{color:#b45309!important}.ppvb-percent{color:#2563eb!important}.ppvb-list{display:flex;flex-direction:column;gap:10px}.ppvb-row{border:1px solid var(--border-color);border-radius:10px;padding:10px;background:var(--card-bg, var(--fg-color))}.ppvb-row-head{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:7px}.ppvb-project{font-weight:700;font-size:14px;color:var(--text-color);max-width:60%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ppvb-values{font-size:13px;font-weight:700;color:var(--text-muted)}.ppvb-bars{display:flex;height:10px;border-radius:999px;overflow:hidden;background:#e2e8f0}.ppvb-bar.billed{background:linear-gradient(90deg,#22c55e,#16a34a)}.ppvb-bar.unbilled{background:linear-gradient(90deg,#f59e0b,#d97706)}.ppvb-row-foot{margin-top:7px;display:flex;align-items:center;justify-content:space-between;color:var(--text-muted);font-size:12px}.ppvb-row-foot b{color:var(--text-color)}.ppvb-empty{border:1px dashed var(--gray-300);padding:14px;border-radius:10px;color:var(--text-muted);font-size:13px;text-align:center}@media (max-width:1000px){.ppvb-summary{grid-template-columns:repeat(2,minmax(150px,1fr))}.ppvb-project{max-width:55%}}"
}
