{
 "doctype": "Custom HTML Block",
 "name": "Personal Leads by Source Block",
 "module": "Sales Performance Dashboard",
 "private": 0,
 "html": "<div class=\"plsb-card\"><div class=\"plsb-header\">Personal Leads by Source</div><div class=\"plsb-sub\">Lead source split for selected personal scope</div><div class=\"plsb-chart\"></div><div class=\"plsb-empty\" style=\"display:none\">No lead source data available</div></div>",
 "script": "const method = \"sales_performance_dashboard.sales_performance_dashboard.dashboard_chart_source.personal_leads_by_source.personal_leads_by_source.get_data\";\nconst chartWrap = root_element.querySelector('.plsb-chart');\nconst emptyEl = root_element.querySelector('.plsb-empty');\nlet chart = null;\n\nfunction args() {\n  return {\n    chart_name: 'Personal Leads by Source',\n    filters: JSON.stringify({\n      department: localStorage.getItem('spd_personal_dashboard_department') || '',\n      employee: localStorage.getItem('spd_personal_dashboard_employee') || '',\n    }),\n  };\n}\n\nfunction render(data) {\n  const labels = (data && data.labels) || [];\n  const values = ((data && data.datasets && data.datasets[0] && data.datasets[0].values) || []).map((v) => cint(v || 0));\n  const total = values.reduce((a, b) => a + b, 0);\n\n  chartWrap.innerHTML = '';\n  if (!labels.length || !values.length || total <= 0) {\n    emptyEl.style.display = 'block';\n    return;\n  }\n\n  emptyEl.style.display = 'none';\n  chart = new frappe.Chart(chartWrap, {\n    type: 'donut',\n    height: 280,\n    showLegend: 1,\n    data: { labels, datasets: [{ values }] },\n    tooltipOptions: {\n      formatTooltipY: (v) => `${cint(v || 0)} lead(s)`,\n    },\n  });\n\n  chartWrap.querySelectorAll('.graph-stats-container,.stats').forEach((el) => {\n    el.style.display = 'none';\n  });\n}\n\nfunction load() {\n  frappe.call({ method, args: args() })\n    .then((r) => render(r.message || {}))\n    .catch(() => {\n      chartWrap.innerHTML = '';\n      emptyEl.style.display = 'block';\n      emptyEl.textContent = 'Could not load lead source data';\n    });\n}\n\nwindow.addEventListener('spd-personal-changed', load);\nload();\n",
 "style": ".plsb-card{position:relative;background:var(--card-bg, var(--fg-color));border:1px solid var(--border-color);border-radius:14px;padding:14px;box-shadow:0 3px 14px rgba(15,23,42,.05);min-height:320px}.plsb-header{font-size:16px;font-weight:700;margin-bottom:2px}.plsb-sub{color:var(--text-muted);font-size:11px;margin-bottom:8px}.plsb-chart{min-height:250px}.plsb-empty{color:var(--text-muted);font-size:12px;text-align:center;padding:30px 0}"
}
