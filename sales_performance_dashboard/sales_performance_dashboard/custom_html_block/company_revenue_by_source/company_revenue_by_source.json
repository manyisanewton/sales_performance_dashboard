{
 "doctype": "Custom HTML Block",
 "name": "Company Revenue by Source",
 "module": "Sales Performance Dashboard",
 "private": 0,
 "html": "<div class=\"crbs-wrap\"><div class=\"crbs-head\"><h3>Revenue by Deal Source</h3><p>Won opportunity revenue by source for the selected filters.</p><div class=\"crbs-range\"></div></div><div class=\"crbs-chart\"></div><div class=\"crbs-total\">Total Won Revenue: <span class=\"crbs-total-v\"></span></div></div>",
 "script": "const method = 'sales_performance_dashboard.api.company_dashboard_api.get_company_revenue_by_source';\nconst chartRoot = root_element.querySelector('.crbs-chart');\nconst rangeEl = root_element.querySelector('.crbs-range');\nconst totalEl = root_element.querySelector('.crbs-total-v');\nlet chart = null;\n\nfunction asCurrency(v) { return format_currency(flt(v || 0)); }\n\nfunction getFilters() {\n  return {\n    company: localStorage.getItem('spd_company_dashboard_company') || '',\n    department: localStorage.getItem('spd_company_dashboard_department') || '',\n    view_mode: localStorage.getItem('spd_company_dashboard_view_mode') || 'Monthly',\n    reference_date: localStorage.getItem('spd_company_dashboard_reference_date') || frappe.datetime.get_today(),\n    lead_source: localStorage.getItem('spd_company_dashboard_lead_source') || '',\n    limit: 10,\n  };\n}\n\nfunction render(payload) {\n  const labels = payload.labels || [];\n  const values = payload.values || [];\n  const data = {\n    labels,\n    datasets: [{ name: 'Won Revenue', values }],\n  };\n\n  if (!chart) {\n    chart = new frappe.Chart(chartRoot, {\n      data,\n      type: 'bar',\n      height: 320,\n      colors: ['#7c3aed'],\n      axisOptions: { xAxisMode: 'tick', xIsSeries: 1 },\n      tooltipOptions: { formatTooltipY: (v) => asCurrency(v) },\n      barOptions: { spaceRatio: 0.35 },\n    });\n  } else {\n    chart.update(data);\n  }\n\n  const fromDate = payload.from_date ? frappe.datetime.str_to_user(payload.from_date) : '-';\n  const toDate = payload.to_date ? frappe.datetime.str_to_user(payload.to_date) : '-';\n  rangeEl.textContent = `Period: ${fromDate} to ${toDate}`;\n  totalEl.textContent = asCurrency(payload.total || 0);\n}\n\nfunction load() {\n  frappe.call({ method, args: getFilters() }).then((r) => render(r.message || {}));\n}\n\nwindow.addEventListener('spd-company-changed', load);\nload();",
 "style": ".crbs-wrap{background:var(--card-bg, var(--fg-color));border:1px solid var(--border-color);border-radius:14px;padding:14px;box-shadow:0 3px 14px rgba(15,23,42,.05)}.crbs-head h3{margin:0;font-size:18px;font-weight:700}.crbs-head p{margin:2px 0 0 0;font-size:12px;color:var(--text-muted)}.crbs-range{margin-top:6px;font-size:12px;font-weight:600;color:var(--text-muted)}.crbs-chart{min-height:320px}.crbs-total{margin-top:8px;font-size:13px;color:var(--text-muted);font-weight:600}.crbs-total-v{color:#7c3aed;font-weight:800}.crbs-wrap .chart-container svg text,.cgmt-wrap .chart-container svg text,.cpov-wrap .chart-container svg text{fill:var(--text-muted)!important}"
}
