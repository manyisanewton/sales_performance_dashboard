{
 "doctype": "Custom HTML Block",
 "name": "Department Dashboard Filters",
 "module": "Sales Performance Dashboard",
 "private": 0,
 "html": "<div class=\"dsd-global-filter-wrap\"><div class=\"dsd-global-filter-title\">Dashboard Filters</div><div class=\"dsd-global-filter-row\"><div class=\"dsd-global-filter\"><label>Department</label><select class=\"dsd-filter-department\"></select></div><div class=\"dsd-global-filter\"><label>View Mode</label><select class=\"dsd-filter-view\"><option value=\"Monthly\">Monthly</option><option value=\"Yearly\">Yearly</option></select></div><div class=\"dsd-global-filter\"><label>Reference Date</label><input type=\"date\" class=\"dsd-filter-date\" /></div><div class=\"dsd-global-filter\"><label>Risk Window</label><select class=\"dsd-filter-risk\"><option value=\"7\">Next 7 Days</option><option value=\"14\">Next 14 Days</option></select></div></div></div>",
 "script": "const listMethod = \"sales_performance_dashboard.api.department_dashboard_api.get_department_options\";\nconst storageDepartment = 'spd_department_dashboard_department';\nconst storageView = 'spd_department_view_mode';\nconst storageDate = 'spd_department_reference_date';\nconst storageRisk = 'spd_department_risk_window';\nconst selectDepartment = root_element.querySelector('.dsd-filter-department');\nconst selectView = root_element.querySelector('.dsd-filter-view');\nconst inputDate = root_element.querySelector('.dsd-filter-date');\nconst selectRisk = root_element.querySelector('.dsd-filter-risk');\n\nfunction emitFilterChanged() {\n  const payload = {\n    department: selectDepartment.value || '',\n    view_mode: selectView.value || 'Monthly',\n    reference_date: inputDate.value || frappe.datetime.get_today(),\n    risk_window_days: cint(selectRisk.value || 14),\n  };\n\n  localStorage.setItem(storageDepartment, payload.department);\n  localStorage.setItem(storageView, payload.view_mode);\n  localStorage.setItem(storageDate, payload.reference_date);\n  localStorage.setItem(storageRisk, String(payload.risk_window_days));\n\n  window.dispatchEvent(new CustomEvent('spd-department-changed', { detail: payload }));\n}\n\nfunction bind() {\n  selectDepartment.addEventListener('change', emitFilterChanged);\n  selectView.addEventListener('change', emitFilterChanged);\n  inputDate.addEventListener('change', emitFilterChanged);\n  selectRisk.addEventListener('change', emitFilterChanged);\n}\n\nfrappe.call({ method: listMethod }).then((r) => {\n  const rows = r.message || [];\n  selectDepartment.innerHTML = '<option value=\"\">Select department...</option>' + rows.map((d) => `<option value=\"${frappe.utils.escape_html(d)}\">${frappe.utils.escape_html(d)}</option>`).join('');\n\n  const savedDepartment = localStorage.getItem(storageDepartment);\n  const savedView = localStorage.getItem(storageView);\n  const savedDate = localStorage.getItem(storageDate);\n  const savedRisk = localStorage.getItem(storageRisk);\n\n  if (savedDepartment && rows.includes(savedDepartment)) {\n    selectDepartment.value = savedDepartment;\n  } else if (rows.length) {\n    selectDepartment.value = rows[0];\n  }\n\n  if (savedView === 'Monthly' || savedView === 'Yearly') {\n    selectView.value = savedView;\n  }\n\n  inputDate.value = savedDate || frappe.datetime.get_today();\n\n  if (savedRisk === '7' || savedRisk === '14') {\n    selectRisk.value = savedRisk;\n  } else {\n    selectRisk.value = '14';\n  }\n\n  bind();\n  emitFilterChanged();\n});",
 "style": ".dsd-global-filter-wrap{display:flex;flex-direction:column;gap:8px;background:var(--card-bg, var(--fg-color));border:1px solid var(--border-color);border-radius:12px;padding:12px 14px}.dsd-global-filter-title{font-size:14px;font-weight:700;color:var(--text-color)}.dsd-global-filter-row{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}.dsd-global-filter{display:flex;flex-direction:column;gap:6px}.dsd-global-filter label{margin:0;font-size:11px;font-weight:600;color:var(--text-muted)}.dsd-global-filter select,.dsd-global-filter input{height:34px;border:1px solid var(--border-color);border-radius:8px;padding:6px 10px;font-size:13px}.layout-main-section .widget.number-widget-box{border:1px solid var(--border-color)!important;background:var(--card-bg, var(--fg-color))!important}.layout-main-section .widget.number-widget-box .widget-head .widget-title{color:var(--text-muted)!important}.layout-main-section .widget.number-widget-box .widget-body .widget-content .number{color:var(--text-color)!important}@media (max-width:1200px){.dsd-global-filter-row{grid-template-columns:repeat(2,minmax(0,1fr))}}@media (max-width:768px){.dsd-global-filter-row{grid-template-columns:1fr}}"
}
