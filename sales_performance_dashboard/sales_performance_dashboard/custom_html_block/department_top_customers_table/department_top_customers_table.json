{
 "doctype": "Custom HTML Block",
 "name": "Department Top Customers Table",
 "module": "Sales Performance Dashboard",
 "private": 0,
 "html": "<div class=\"dsd-top-customer-card\"><div class=\"dsd-top-customer-header\">Department Top Customers</div><div class=\"dsd-top-customer-sub\">Top customers by billed amount</div><div class=\"dsd-top-customer-wrap\"><table class=\"dsd-top-customer-table\"><thead><tr><th style=\"width:70px\">#</th><th>Customer</th><th>Served By</th><th style=\"text-align:right\">Amount</th></tr></thead><tbody class=\"dsd-top-customer-body\"><tr><td colspan=\"4\" class=\"dsd-top-customer-empty\">Loading...</td></tr></tbody><tfoot><tr><th colspan=\"3\">Total</th><th class=\"dsd-top-customer-total\">-</th></tr></tfoot></table></div></div>",
 "script": "const method = \"sales_performance_dashboard.api.department_dashboard_api.get_department_top_customers_table\";\nconst listMethod = \"sales_performance_dashboard.api.department_dashboard_api.get_department_options\";\nconst body = root_element.querySelector('.dsd-top-customer-body');\nconst totalEl = root_element.querySelector('.dsd-top-customer-total');\nconst storageKey = 'spd_department_dashboard_department';\n\nfunction money(value) {\n\treturn format_currency(value || 0);\n}\n\nfunction render(payload) {\n\tconst rows = payload.rows || [];\n\tconst total = payload.total || 0;\n\n\tif (!rows.length) {\n\t\tbody.innerHTML = '<tr><td colspan=\"4\" class=\"dsd-top-customer-empty\">No data available</td></tr>';\n\t\ttotalEl.textContent = money(0);\n\t\treturn;\n\t}\n\n\tbody.innerHTML = rows\n\t\t.map((row) => `<tr><td>${row.rank}</td><td>${frappe.utils.escape_html(row.customer || '')}</td><td>${frappe.utils.escape_html(row.served_by || '-')}</td><td style=\\\"text-align:right\\\">${money(row.amount)}</td></tr>`)\n\t\t.join('');\n\ttotalEl.textContent = money(total);\n}\n\nfunction loadTable(department) {\n\tfrappe.call({ method, args: { department, limit: 20 } }).then((r) => {\n\t\trender(r.message || {});\n\t});\n}\n\nfunction loadFromStorageOrDefault() {\n\tconst selectedDepartment = localStorage.getItem(storageKey);\n\tif (selectedDepartment) {\n\t\tloadTable(selectedDepartment);\n\t\treturn;\n\t}\n\n\tfrappe.call({ method: listMethod }).then((r) => {\n\t\tconst rows = r.message || [];\n\t\tif (rows.length) {\n\t\t\tlocalStorage.setItem(storageKey, rows[0]);\n\t\t\tloadTable(rows[0]);\n\t\t\treturn;\n\t\t}\n\t\trender({ rows: [], total: 0 });\n\t});\n}\n\nwindow.addEventListener('spd-department-changed', () => {\n\tloadTable(localStorage.getItem(storageKey) || '');\n});\n\nloadFromStorageOrDefault();\n",
 "style": ".dsd-top-customer-card{position:relative;background:#fff;border:1px solid var(--gray-200);border-radius:14px;padding:14px 14px 10px;box-shadow:0 3px 14px rgba(15,23,42,.05)}.dsd-top-customer-header{font-size:16px;font-weight:700;margin-bottom:2px}.dsd-top-customer-sub{color:var(--text-muted);font-size:11px;margin-bottom:8px}.dsd-top-customer-wrap{overflow:auto;max-height:420px}.dsd-top-customer-table{width:100%;border-collapse:collapse;font-size:12px}.dsd-top-customer-table th,.dsd-top-customer-table td{padding:8px 10px;border-bottom:1px solid var(--gray-100)}.dsd-top-customer-table thead th{position:sticky;top:0;background:#fff;z-index:1}.dsd-top-customer-table tfoot th{background:#fafafa;font-weight:700}.dsd-top-customer-empty{text-align:center;color:var(--text-muted);padding:16px}"
}
