{
 "doctype": "Custom HTML Block",
 "name": "Department Forecasted Revenue Block",
 "module": "Sales Performance Dashboard",
 "private": 0,
 "html": "<div class=\"dsd-forecast-card\"><div class=\"dsd-forecast-header\">Department Forecasted Revenue</div><div class=\"dsd-forecast-sub\">Forecasted vs actual totals for selected department</div><div class=\"dsd-forecast-chart\"></div></div>",
 "script": "const method = \"sales_performance_dashboard.sales_performance_dashboard.dashboard_chart_source.department_forecasted_revenue.department_forecasted_revenue.get_data_for_custom\";\nconst storageDepartment = 'spd_department_dashboard_department';\nconst storageDate = 'spd_department_reference_date';\nconst chartRoot = root_element.querySelector('.dsd-forecast-chart');\nlet chart = null;\n\nfunction load() {\n  const department = localStorage.getItem(storageDepartment) || '';\n  const reference_date = localStorage.getItem(storageDate) || frappe.datetime.get_today();\n\n  frappe.call({ method, args: { department, reference_date } }).then((r) => {\n    const data = r.message || { labels: [], datasets: [] };\n    if (!chart) {\n      chart = new frappe.Chart(chartRoot, {\n        data,\n        type: 'bar',\n        height: 280,\n        colors: ['#ef6fa1', '#2f7fd0'],\n        axisOptions: { xIsSeries: 1, xAxisMode: 'tick' }\n      });\n      return;\n    }\n    chart.update(data);\n  });\n}\n\nwindow.addEventListener('spd-department-changed', load);\nload();",
 "style": ".dsd-forecast-card{position:relative;background:var(--card-bg, var(--fg-color));border:1px solid var(--border-color);border-radius:14px;padding:14px 14px 10px;box-shadow:0 3px 14px rgba(15,23,42,.05)}.dsd-forecast-header{font-size:16px;font-weight:700;margin-bottom:2px}.dsd-forecast-sub{color:var(--text-muted);font-size:11px;margin-bottom:8px}.dsd-forecast-chart{min-height:280px}"
}
